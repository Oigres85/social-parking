{
  "entities": {
    "Parking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Parking",
      "type": "object",
      "description": "Represents a parking spot location and status.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the parking spot."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude of the parking spot."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude of the parking spot."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp when the parking spot was recorded.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the parking spot (e.g., 'libero')."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who parked. (Relationship: User 1:N Parking)"
        }
      },
      "required": [
        "id",
        "latitude",
        "longitude",
        "timestamp",
        "status",
        "userId"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Name of the user."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude of the user's current location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude of the user's current location."
        },
        "isSearching": {
            "type": "boolean",
            "description": "Indicates whether the user is currently looking for a parking spot."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership: only the user with the matching userId can read/write their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/parkings/{parkingId}",
        "definition": {
          "entityName": "Parking",
          "schema": {
            "$ref": "#/backend/entities/Parking"
          },
          "description": "Stores parking spot information, including location, timestamp, status, and the userId of the user who created the parking. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "parkingId",
              "description": "The unique identifier for the parking spot."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure prioritizes real-time location data for parking spot availability and user notifications. The core design implements Authorization Independence through path-based ownership for user data and denormalization of the userId into the parkings collection. This eliminates the need for `get()` calls in security rules to validate the parking's owner and enables atomic operations. The structure also enables secure list operations through structural segregation.\n\nSpecifically, each user's data (location and searching status) is stored under `/users/{userId}`. Parkings are stored in the `/parkings` collection, which includes the denormalized `userId` field, this permits listing of all parking spots while enabling fine-grained control over creation/updates using security rules based on `request.auth.uid` matching the `userId` field.\n\nThis structure supports the required features:\n\n*   **Real-time GPS Monitoring and Parking Status Logic**: The `/parkings` collection stores the parking spot locations, updated in real-time. The `status` field reflects the parking status (e.g., 'libero').\n*   **User Location Data**: The `/users/{userId}` collection stores each user's current location and searching status.\n*   **Proximity Notifications**: When a parking spot becomes available, users who are searching nearby will be notified by listening to the `/parkings` collection and filtering on the client-side."
  }
}
